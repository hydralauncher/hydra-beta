---
import Layout from "../layouts/layout.astro";
import { App } from "../app";
import { ACCESS_TOKEN_EXPIRATION_OFFSET_IN_MS, api } from "@/services";
import type { User } from "@/types";

const getUser = async () => {
  const accessToken = Astro.locals.accessToken;

  if (!accessToken) return null;

  return await api
    .get<User>("users/", {
      headers: {
        Authorization: `Bearer ${accessToken}`,
      },
    })
    .json();
};

const profile = await getUser();
---

<Layout>
  <App client:load initialPath="/profile" profile={profile} />
</Layout>
