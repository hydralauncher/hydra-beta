---
import Layout from "@/layouts/layout.astro";
import { App } from "@/app";
import { api } from "@/services";
import type { User } from "@/types";

const { id } = Astro.params;

const getUser = async () => {
  const accessToken = Astro.locals.accessToken;

  const headers: Record<string, string> = {};
  if (accessToken) {
    headers.Authorization = `Bearer ${accessToken}`;
  }

  return await api
    .get<User>(`users/${id}`, {
      headers,
    })
    .json();
};

const profile = await getUser();
---

<Layout>
  <App client:load initialPath={`/profile/${id}`} profile={profile} />
</Layout>
